---
import Layout from "@/layouts/Layout.astro"
import { getPages } from "@/graphql"
import { MainBanner } from "c/index"
import { getInfoFromImg } from "@/hooks"

const pages = await getPages()


 const pageInfo = pages?.find(page => {
 const { attributes } = page
 const { slug } = attributes
 return slug === Astro.url.pathname
})

 const getMainImg = () => {
 if(pageInfo) {
  try {
   const { attributes } = pageInfo
   const { imagen } = attributes
   if(!imagen) return null
   const mainImg = getInfoFromImg(imagen)
   return mainImg
  } catch (error) {
   console.error(error)
   return null
  }
 }
}

const mainImg = getMainImg()

const getAttributes = () => {
 if(pageInfo) {
  const {attributes} = pageInfo
  return attributes
 }
}

const attributes = getAttributes() 

---

{attributes && <Layout title={attributes.titulo} description={attributes.descripcion} image={mainImg ? mainImg.url : undefined} >
 {attributes.contenido?.map(content => {
  const { __typename: name} = content

  if(name === 'ComponentComponentesImagenPrincipal') {
   const { mobile, desk } = content
   
   return <MainBanner mobil={mobile} desk={desk} />
  }
 })}
</Layout>}
